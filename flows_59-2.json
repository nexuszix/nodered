[{"id":"10cb2717.cf00f1","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"9cb5d892.7593c8","type":"function","z":"10cb2717.cf00f1","name":"to Array","func":"var input = msg.payload;\nvar starttext = \"หมายเหตุ\";\nvar start = input.search(starttext)+8;\nvar end = input.length;\nmsg.payload = input.substring(start, end);\nfor(var i = 0; i < 4; i++) {\n    start = msg.payload.search(starttext)+8;\n    end = msg.payload.length;\n    msg.payload = msg.payload.substring(start, end);\n} \n//msg.payload = start;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":340,"wires":[["cadb525c.786c1"]]},{"id":"b838c930.21ad98","type":"converter","z":"10cb2717.cf00f1","name":"encoder","from":"win874","x":360,"y":280,"wires":[["9cb5d892.7593c8"]]},{"id":"cadb525c.786c1","type":"html","z":"10cb2717.cf00f1","name":"","property":"payload","tag":"td","ret":"text","as":"single","x":420,"y":520,"wires":[["ad332de9.70169"]]},{"id":"296ba74f.99225","type":"http in","z":"10cb2717.cf00f1","name":"load","url":"/load","method":"get","upload":false,"swaggerDoc":"","x":120,"y":260,"wires":[["a74b5235.1359a"]]},{"id":"860b6308.e3e33","type":"http response","z":"10cb2717.cf00f1","name":"","statusCode":"","headers":{},"x":830,"y":380,"wires":[]},{"id":"ad332de9.70169","type":"function","z":"10cb2717.cf00f1","name":"split","func":"var input = msg.payload;\nvar output = [];\nfunction getAbbr(name){\n    var start = name.lastIndexOf(\"(\");\n    var end = name.lastIndexOf(\")\");\n    return name.slice(start+1, end)\n}\nfor (var i = 0; i < input.length - 9; i+=10) {\n    var row = {\n        'stock_abbr': getAbbr(input[i]),\n        'company': input[i],\n        'director': input[i+1],\n        'relationship': input[i+2],\n        'stock_type': input[i+3],\n        'doc_date': input[i+4],\n        'received_date': input[i+5],\n        'amount': input[i+6],\n        'price': input[i+7],\n        'transaction_type': input[i+8],\n        'remark': input[i+9]\n    };\n    output.push(row);\n}\nmsg.payload = output;\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":480,"wires":[["ffacd73d.e39f88"]]},{"id":"59bf7e8f.b7961","type":"http request","z":"10cb2717.cf00f1","name":"59-2 post","method":"POST","ret":"bin","url":"http://capital.sec.or.th/webapp/corp_fin2/result59d.php","tls":"","x":190,"y":440,"wires":[["b838c930.21ad98"]]},{"id":"a74b5235.1359a","type":"function","z":"10cb2717.cf00f1","name":"Post 59-2","func":"var today = new Date();\nvar dd = today.getDate();\nvar mm = today.getMonth()+1; //January is 0!\nvar yyyy = today.getFullYear()+543;\nvar syy = parseInt(msg.payload.syy) + 543;\nvar eyy = parseInt(msg.payload.eyy) + 543;\n\nif(dd<10) {\n    dd = '0'+dd\n} else{\n    dd = dd.toString();\n}\n\nif(mm<10) {\n    mm = '0'+mm\n} else {\n    mm = mm.toString();\n}\n\noutput = { \n    rad_date: \"2\",\n    cmb_sd: msg.payload.sdd,\n    cmb_sm: msg.payload.smm,\n    cmb_sy: syy.toString(),\n    cmb_ed: msg.payload.edd,\n    cmb_em: msg.payload.emm,\n    cmb_ey: eyy.toString(),\n    dd: msg.payload.edd,\n    mm: msg.payload.emm,\n    yy: eyy.toString(),\n};\nmsg.payload = output\nmsg.headers = {'content-type':'application/x-www-form-urlencoded'};\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":360,"wires":[["59bf7e8f.b7961"]]},{"id":"ffacd73d.e39f88","type":"json","z":"10cb2717.cf00f1","name":"","property":"payload","action":"","pretty":false,"x":680,"y":360,"wires":[["860b6308.e3e33"]]}]